# 第 3 章 传输层

## 传输层的基本服务

传输层的**核心任务**：为应用进程之间提供端到端的逻辑通讯服务。

功能：

* 传输层寻址
* 对应用层报文进行分段和重组
* 对报文进行差错检测
* 实现进程间端到端可靠数据传输控制
* 面向应用层实现复用与分解
* 实现端到端的流量控制
* 拥塞控制

通信的真正端点不是主机，而是主机中运行的应用进程。

传输层端口号为16位整数，包含三类端口：

* 熟知端口号，数值为0-1023
* 登记端口号，数值为1024-49151,
* 客户端口号或短暂端口号，数值为49152-65535

## 传输层的复用与分解

TCP套接字 -> <源IP地址，源端口号，目的IP地址，目的端口号>

## 停—等协议与滑动窗口协议

不可靠传输信道在数据传输中可能发生：

1. 比特差错
2. 乱序
3. 数据丢失

实现可靠数据传输措施：

1. 差错检测
2. 确认：ACK（肯定确认）；NAK（否定确定）
3. 重传
4. 序号
5. 计时器

停—等协议的基本工作过程是：

1. 发送方经过差错编码和编号的报文段，等待接收方的确认
2. 接收方如果正确接收报文段，即差错检测无误且序号正确，则接收报文段，并向发送方发送ACK
3. 否则丢弃报文段，并向发送方发送NAK
4. 发送方如果收到ACK，则继续发送后续报文段，否则重发刚刚发送的报文段

**滑动窗口协议**实质上就是将可靠数据传输的工作过程，抽象到分组序号空间，即发送方确保分组按序发送，接收方确保分组按序提交。

两种最具代表性的滑动窗口协议是：**GBN协议**（发送窗口>=1，接收窗口=1）和**SR协议**（发送窗口和接收窗口都大于1）

TCP的拥塞控制算法：

包括了慢启动、拥塞避免、快速重传和快速恢复

## 用户数据报协议（UDP）

UDP相比TCP的优点：

* 应用进程更容易控制发送什么数据以及何时发送
* 无需建立连接
* 无连接状态
* 首部开销小



## 传输控制协议（TCP）

TCP协议特点：

* 应用进程要先建立连接
* 每一条TCP连接只有两个端点
* 可靠交付。无差错，不丢失，不重复且按序到达
* 全双工通信
* 面向字节流



**拥塞控制**就是通过合理调度、规范、调整向网咯中发送数据的主机数量、发送速率或数据量，以避免拥塞或尽快消除已发生的堵塞。